(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{579:function(t,a,s){"use strict";s.r(a);var n=s(4),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"_2020-4-17-4-19"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2020-4-17-4-19"}},[t._v("#")]),t._v(" 2020.4.17 - 4.19")]),t._v(" "),s("p",[t._v("万能的方法")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("# 查询某一个类的全部属性和方法\nprint(dir(object))\n# 查看函数或模块用途的详细说明\nhelp(object)\n# 查看具体类中某方法的详细说明\nhelp(object.method_name)\n")])])]),s("h2",{attrs:{id:"当前项目的开发环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#当前项目的开发环境"}},[t._v("#")]),t._v(" 当前项目的开发环境")]),t._v(" "),s("ul",[s("li",[t._v("python版本：Python 3.6.10")]),t._v(" "),s("li",[t._v("Django版本：2.2.10")]),t._v(" "),s("li",[t._v("利用的模板：\n"),s("ul",[s("li",[t._v("后台是Amazon UI后台")]),t._v(" "),s("li",[t._v("前台为Bootstrap4网上书店模板书店商城，Koparion")])])]),t._v(" "),s("li",[t._v("假如创建好项目无法运行\n"),s("ul",[s("li",[t._v("找到run/debug configurations")]),t._v(" "),s("li",[t._v("在parametes 内写入 runserver")])])])]),t._v(" "),s("h2",{attrs:{id:"项目的结构搭建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#项目的结构搭建"}},[t._v("#")]),t._v(" 项目的结构搭建")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("1.创建项目，到一个xjq_django 下执行 django-admin startproject bookshop")])]),t._v(" "),s("li",[s("ol",{attrs:{start:"2"}},[s("li",[t._v("创建static文件夹，用于存放静态文件(html页面所需要的css和js)")])])]),t._v(" "),s("li",[s("p",[t._v("3.在bookshop文件夹下创建两个个app 执行")]),t._v(" "),s("ul",[s("li",[t._v("python manage.py startapp myhome    前台")]),t._v(" "),s("li",[t._v("python manage.py startapp myadmin   后台")])])]),t._v(" "),s("li",[s("p",[t._v("4.配置bookshop 内的settings")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("INSTALLED_APPS（安装app） 内加入新创建的  myhome 和 myadmin 两个app")])]),t._v(" "),s("li",[s("p",[t._v("配置TEMOLATES模板文件的读取路径")])]),t._v(" "),s("li",[s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("os"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("join"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("BASE_DIR"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'templates'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("数据库的配置（下面为mysql的配置）")]),t._v(" "),s("ul",[s("li",[t._v("配置好打开数据库的名字（bookshop）")]),t._v(" "),s("li",[t._v("登录数据库的操作用户（root）")]),t._v(" "),s("li",[t._v("登录数据库的操作用户的密码（空）")]),t._v(" "),s("li",[t._v("数据库端口号默认是3306")])])]),t._v(" "),s("li",[s("p",[t._v("再打开cmd，mysql内创建一个名叫bookshop的数据库")]),t._v(" "),s("ul",[s("li",[t._v("1.进入mysql mysql -u root -p")]),t._v(" "),s("li",[t._v("2.创建数据库 create database bookshop default charset=utf8mb4;")]),t._v(" "),s("li",[t._v("相关mysql操作可以到桌面上的mysql相关进行复习")])])])])]),t._v(" "),s("li",[s("ol",{attrs:{start:"5"}},[s("li",[t._v("配置时区和语言")])]),t._v(" "),s("ul",[s("li",[t._v("设置语言 zh-Hans 为中文 en-us 为英文")]),t._v(" "),s("li",[t._v("LANGUAGE_CODE = 'zh-Hans'")]),t._v(" "),s("li",[t._v("设置时区 亚洲上海")]),t._v(" "),s("li",[t._v("TIME_ZONE = 'Asia/Shanghai'")])])]),t._v(" "),s("li",[s("p",[t._v("6.在templates模板文件价和static静态文件夹内都创建爱你myadmin和myhome两个文件")])]),t._v(" "),s("li",[s("p",[t._v("因为前后台用的模板不一样，所以前后台运用的css和jss也不一样")])]),t._v(" "),s("li",[s("p",[t._v("7.在static内创建一个upload文件夹，用于存放前后台都需要的图片存放")])]),t._v(" "),s("li",[s("p",[t._v("至此，基本文件目录创建完成")])])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"前台页面和后台页面的基本搭建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前台页面和后台页面的基本搭建"}},[t._v("#")]),t._v(" 前台页面和后台页面的基本搭建")]),t._v(" "),s("ul",[s("li",[t._v("把前台后后台用到的模板和模板所需的静态文件，分别拷贝到对应的templates和static文件夹中的不同分类中")]),t._v(" "),s("li",[t._v("利用替换将原来的assets/")])]),t._v(" "),s("p",[s("img",{attrs:{src:"BookShop%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0.assets/1.png",alt:"1"}})]),t._v(" "),s("ul",[s("li",[t._v("修改为/static/myadmin")]),t._v(" "),s("li",[t._v("前台也是如此，这样页面的基本搭建就完成了")])]),t._v(" "),s("h2",{attrs:{id:"后台开发"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#后台开发"}},[t._v("#")]),t._v(" 后台开发")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("功能")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("注册")])]),t._v(" "),s("li",[s("p",[t._v("会员管理")]),t._v(" "),s("ul",[s("li",[t._v("查看会员列表，查看详细信息，禁用，修改，删除，添加（正常网站都无删数据的功能）（数据对于公司来说是无价滴），用禁用来代替")])])]),t._v(" "),s("li",[s("p",[t._v("图书分类（暂时不做）")])]),t._v(" "),s("li",[s("p",[t._v("图书商品")])]),t._v(" "),s("li",[s("p",[t._v("订单详情")])]),t._v(" "),s("li",[s("p",[t._v("权限管理")]),t._v(" "),s("hr")])])])]),t._v(" "),s("h2",{attrs:{id:"会员管理页面的搭建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#会员管理页面的搭建"}},[t._v("#")]),t._v(" 会员管理页面的搭建")]),t._v(" "),s("ul",[s("li",[t._v("视图里面添加对对应的函数")])]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"BookShop项目笔记.assets/QQ截图20200417110558.png",alt:"QQ截图20200417110558"}}),t._v(" "),s("ul",[s("li",[s("p",[t._v("路由里面添加对应的路由")])]),t._v(" "),s("li",[s("p",[t._v("利用反向解析路由，来配置index.html内的a链接的值")])])]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"BookShop项目笔记.assets/QQ截图20200417111709.png",alt:"QQ截图20200417111709"}}),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("- htm内属性的值必须在引号内， \n- 反向解析固定写法**{% url '写你想要跳转页面的名字' %}**\n- <i> 标签显示斜体文本效果。\n- 标签<ul>定义无序列表 \n")])])]),s("hr"),t._v(" "),s("ul",[s("li",[t._v("在templates文件夹内创建，一个users文件夹，里面存放关于用户的页面模板")]),t._v(" "),s("li",[t._v("users内的index页面是继承了myadmin后台文件的index.html页面")])]),t._v(" "),s("div",{staticClass:"language-txt extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("# 继承某个页面\n{% extends 'myadmin/index.html' %}\n\n# 重写html里的某个代码块,block包裹， con，为包裹内容的name\n{% block con %}\n\t中间为想要重写的html代码\n{% endblock %}\n")])])]),s("ul",[s("li",[s("p",[t._v("重写会员管理的模块内容，其余的和首页无差别。")])]),t._v(" "),s("li",[s("p",[t._v("python 格式化代码")]),t._v(" "),s("ul",[s("li",[t._v("Ctrl + Alt + L")])])])]),t._v(" "),s("h2",{attrs:{id:"后台添加页面和模型的设计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#后台添加页面和模型的设计"}},[t._v("#")]),t._v(" 后台添加页面和模型的设计")]),t._v(" "),s("ul",[s("li",[s("em",[s("strong",[t._v("快捷键缩进 Tab， 缩退，shift+Tab")])])])]),t._v(" "),s("h3",{attrs:{id:"用户模型的建立与构想"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#用户模型的建立与构想"}},[t._v("#")]),t._v(" 用户模型的建立与构想")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[t._v("列名")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("字段(属性名)")]),t._v(" "),s("th",[t._v("类型（在数据库中的存储形式）")]),t._v(" "),s("th",[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("ID")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("id")]),t._v(" "),s("td",[t._v("主键")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("用户名")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("User_name")]),t._v(" "),s("td",[t._v("Varchar")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("密码")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("Pass_word")]),t._v(" "),s("td",[t._v("char(80)[需要用到加密]")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("手机号")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("Phone")]),t._v(" "),s("td",[t._v("char(11)")]),t._v(" "),s("td",[t._v("唯一索引")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("性别")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("Sex")]),t._v(" "),s("td",[t._v("Tinyint")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("年龄")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("Age")]),t._v(" "),s("td",[t._v("Tinyint")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("注册时间")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("Add_time")]),t._v(" "),s("td",[t._v("Datetime")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("最后登录时间")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("Save_time")]),t._v(" "),s("td",[t._v("Datetime")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("状态")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("Status")]),t._v(" "),s("td",[t._v("Tinyint")]),t._v(" "),s("td",[t._v("默认为0，禁用为1")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("头像")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("Face_url")]),t._v(" "),s("td",[t._v("Varchar")]),t._v(" "),s("td",[t._v("存储头像的路径")])])])]),t._v(" "),s("h2",{attrs:{id:"模型的设计（简称数据库的设计）"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#模型的设计（简称数据库的设计）"}},[t._v("#")]),t._v(" 模型的设计（简称数据库的设计）")]),t._v(" "),s("p",[t._v("https://docs.djangoproject.com/zh-hans/2.2/ref/models/fields/#datetimefield")]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"BookShop项目笔记.assets/QQ截图20200419093602.png",alt:"QQ截图20200419093602"}}),t._v(" "),s("p",[t._v("模型设计好后，进行数据库的迁移")]),t._v(" "),s("h2",{attrs:{id:"数据库的迁移"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据库的迁移"}},[t._v("#")]),t._v(" 数据库的迁移")]),t._v(" "),s("ul",[s("li",[t._v("1.在bookshop项目文件路径内\n"),s("ul",[s("li",[t._v("执行迁移准备")]),t._v(" "),s("li",[t._v("python manage.py makemigrations")])])]),t._v(" "),s("li",[t._v("2、再执行迁移操作\n"),s("ul",[s("li",[t._v("python manage.py migrate")]),t._v(" "),s("li",[t._v("要在当前项目bookshop下执行")])])])]),t._v(" "),s("h2",{attrs:{id:"创建一个表单from来接收web发来的数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建一个表单from来接收web发来的数据"}},[t._v("#")]),t._v(" 创建一个表单from来接收web发来的数据")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("表单能接收当前web页面的信息然后再提交给后台进行处理")])]),t._v(" "),s("li",[s("p",[t._v("想要表单能够接收图片，from里面方法必须为post，且有enctyppe")]),t._v(" "),s("ul",[s("li",[t._v("from表单必须要写明提交给哪个网页，然后由那个网页的后台views来进行逻辑处理")]),t._v(" "),s("li",[t._v("action=\"{% url 'myadmin_user_add' %}")])])]),t._v(" "),s("li",[s("p",[t._v("由于是post提交，还需要手动加上csrf_token验证")]),t._v(" "),s("ul",[s("li",[s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("form")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("action")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("{% url 'myadmin_user_add' %}"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("am-form tpl-form-line-form"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("method")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("post"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("enctype")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("multipart/form-data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n {% csrf_token %}\n")])])])])])]),t._v(" "),s("li",[s("p",[t._v("至此，from表单内的数据才可以提交到另一个网站上去，也可以提交给当前页面的后台进行处理，这里就是提交给当前页面的后台进行处理数据")])])]),t._v(" "),s("h2",{attrs:{id:"后台处理数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#后台处理数据"}},[t._v("#")]),t._v(" 后台处理数据")]),t._v(" "),s("h3",{attrs:{id:"接收web的数据进行处理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#接收web的数据进行处理"}},[t._v("#")]),t._v(" 接收web的数据进行处理")]),t._v(" "),s("ul",[s("li",[t._v("前提：请求方法为POST")]),t._v(" "),s("li",[t._v("后台逻辑：\n"),s("ul",[s("li",[t._v("接收表单数据，数据为dict对象，并把认证的csrf弹出")]),t._v(" "),s("li",[s("img",{staticStyle:{zoom:"67%"},attrs:{src:"BookShop项目笔记.assets/QQ截图20200419134334.png",alt:"QQ截图20200419134334"}})]),t._v(" "),s("li",[t._v("对密码进行加密")]),t._v(" "),s("li",[s("img",{staticStyle:{zoom:"67%"},attrs:{src:"BookShop项目笔记.assets/QQ截图20200419134409.png",alt:"QQ截图20200419134409"}})]),t._v(" "),s("li",[t._v("判断是否有头像上传")]),t._v(" "),s("li",[t._v("最后把数据存入数据库中，需要把models文件导入进去")]),t._v(" "),s("li",[s("img",{staticStyle:{zoom:"67%"},attrs:{src:"BookShop项目笔记.assets/QQ截图20200419134717.png",alt:"QQ截图20200419134717"}})])])])]),t._v(" "),s("h1",{attrs:{id:"_2020-4-17-4-19-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2020-4-17-4-19-2"}},[t._v("#")]),t._v(" 2020.4.17 - 4.19")]),t._v(" "),s("h2",{attrs:{id:"后台处理web上传的图片"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#后台处理web上传的图片"}},[t._v("#")]),t._v(" 后台处理web上传的图片")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("https://docs.djangoproject.com/zh-hans/2.2/ref/request-response/#attributes")])]),t._v(" "),s("li",[s("p",[t._v("参考网站，处理的是请求对象中的文件属性")])])]),t._v(" "),s("h3",{attrs:{id:"上传的文件需要改名"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#上传的文件需要改名"}},[t._v("#")]),t._v(" 上传的文件需要改名")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("防止不同的人上传同一个名字的文件，在数据库中造成覆盖")])]),t._v(" "),s("li",[s("p",[t._v("实现逻辑")]),t._v(" "),s("ul",[s("li",[t._v("先从web端拿到文件，利用.name.split分割为list，pop出文件的类型")]),t._v(" "),s("li",[t._v("判断是否为规定图片的类型")]),t._v(" "),s("li",[t._v("定义存储图片的名字，利用随机数的产生来命名，进行字符串相加")]),t._v(" "),s("li",[t._v("打开当前文件的根目录下，将文件写入到服务器电脑上的目录下")]),t._v(" "),s("li",[t._v("再把该文件的路径给存入数据库中")]),t._v(" "),s("li")])]),t._v(" "),s("li",[s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("a "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1,2,3'")]),t._v("\nx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("split"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("','")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pop"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 剩下的是3")]),t._v("\na "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1,2,3'")]),t._v("\nx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("split"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("','")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pop"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 剩下的是 1,2")]),t._v("\na "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1,2,3'")]),t._v("\nx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("split"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("','")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pop"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 剩下的是 3")]),t._v("\n\n\npop"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("方法返回的是弹出的元素，默认弹出最后的一个元素\n")])])])]),t._v(" "),s("li",[s("img",{staticStyle:{zoom:"67%"},attrs:{src:"BookShop项目笔记.assets/QQ截图20200420113634.png",alt:"QQ截图20200420113634"}})])]),t._v(" "),s("h2",{attrs:{id:"上传图片的预加载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#上传图片的预加载"}},[t._v("#")]),t._v(" 上传图片的预加载")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("在web中暂时显示要上传的图片")])]),t._v(" "),s("li",[s("p",[t._v("实现技术")]),t._v(" "),s("ul",[s("li",[t._v("JavaScript脚本语言实现")]),t._v(" "),s("li")])]),t._v(" "),s("li",[s("p",[t._v("实现逻辑")]),t._v(" "),s("ul",[s("li",[t._v("获得当前"),s("input"),t._v(" 标签的控制权，给他绑定一个事件函数")]),t._v(" "),s("li",[t._v("判断是否选择了图片\n"),s("ul",[s("li",[t._v("否：获得"),s("img"),t._v(" 标签控制权，设置src属性为空")]),t._v(" "),s("li",[t._v("是：获取当前用户选择的图片的对象，然后将对象的值赋予img标签的src")])])])])])]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"BookShop项目笔记.assets/QQ截图20200420113507.png",alt:"QQ截图20200420113507"}}),t._v(" "),s("h1",{attrs:{id:"_2020-4-27-5-1"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2020-4-27-5-1"}},[t._v("#")]),t._v(" 2020.4.27 - 5.1")]),t._v(" "),s("h2",{attrs:{id:"后台显示数据库中的数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#后台显示数据库中的数据"}},[t._v("#")]),t._v(" 后台显示数据库中的数据")]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"BookShop项目笔记.assets/QQ截图20200427084345.png",alt:"QQ截图20200427084345"}}),t._v(" "),s("ul",[s("li",[s("p",[t._v("逻辑：")]),t._v(" "),s("ul",[s("li",[t._v("导入模板类 from . import models")]),t._v(" "),s("li",[t._v("得到数据")]),t._v(" "),s("li",[t._v("分配数据")])])]),t._v(" "),s("li",[s("p",[t._v("加载入模板")])]),t._v(" "),s("li",[s("img",{staticStyle:{zoom:"67%"},attrs:{src:"BookShop项目笔记.assets/QQ截图20200427084513.png",alt:"QQ截图20200427084513"}})]),t._v(" "),s("li",[s("p",[t._v("在html网页中使用数据需要在两个大括号内进行")])]),t._v(" "),s("li",[s("p",[t._v("而代码则是需要一个大括号加一个%")])])]),t._v(" "),s("h2",{attrs:{id:"利用ajax完成不跳转删除"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#利用ajax完成不跳转删除"}},[t._v("#")]),t._v(" 利用ajax完成不跳转删除")]),t._v(" "),s("p",[t._v("​    "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"BookShop项目笔记.assets/QQ截图20200427095754.png",alt:"QQ截图20200427095754"}})]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"BookShop项目笔记.assets/QQ截图20200427095832.png",alt:"QQ截图20200427095832"}}),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"BookShop项目笔记.assets/QQ截图20200427095851.png",alt:"QQ截图20200427095851"}}),t._v(" "),s("h1",{attrs:{id:"_2020-5-21-30"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2020-5-21-30"}},[t._v("#")]),t._v(" 2020.5.21-30")]),t._v(" "),s("h2",{attrs:{id:"对数据库进行搜索数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#对数据库进行搜索数据"}},[t._v("#")]),t._v(" 对数据库进行搜索数据")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("select_type "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("GET"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'select_type'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nkey_words "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("GET"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'key_words'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" select_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 当搜索条件不为空")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" select_type "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'all'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" django"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("models "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Q\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 参考文档")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# https://docs.djangoproject.com/zh-hans/2.2/topics/db/queries/#complex-lookups-with-q-objects")]),t._v("\n        data "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("filter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            Q"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id__contains"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("key_words"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" Q"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("User_name__contains"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("key_words"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" Q"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Phone__contains"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("key_words"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# select * from users where id like '%keywords%' or username like '%keywords%' or Phone like '%keywords%'")]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# return HttpResponse(f'<script> alert(\"依据全部搜索\");history.go(-1) <\/script>')")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        search "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("f'")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("select_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("__contains'")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" key_words"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        data "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("filter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("**")]),t._v("search"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# return HttpResponse(f'<script> alert(\"其余\"); history.go(-1) <\/script>')")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 分配数据")]),t._v("\ncontext "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'data'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 加载模板")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" render"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'myadmin/users/index.html'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" context"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("函数传参前面加两个**代表，以 v1=k1,v2=k2,v3=k3....这么传进去")]),t._v(" "),s("h2",{attrs:{id:"将数据库中的数据进行分页处理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#将数据库中的数据进行分页处理"}},[t._v("#")]),t._v(" 将数据库中的数据进行分页处理")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""分页功能"""')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 参考文档https://docs.djangoproject.com/zh-hans/2.2/topics/pagination/")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" django"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("paginator "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Paginator\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 实例分页对象，传入数据，以及要分几页")]),t._v("\ndata "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" models"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Users"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("objects"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\np "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Paginator"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取当前页码,默认为1")]),t._v("\npage_index "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("GET"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'page'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 根据页码获得当前页的数据")]),t._v("\ndata "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("page"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("page_index"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 分配数据")]),t._v("\ncontext "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'data'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 加载模板")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" render"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'myadmin/users/index.html'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" context"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"分页优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#分页优化"}},[t._v("#")]),t._v(" 分页优化")]),t._v(" "),s("ul",[s("li",[t._v("分页优化要借助下面的模板自定义标签")]),t._v(" "),s("li",[t._v("在应用中创建一个文件，在文件中写入内容，自己定义需要的功能函数")]),t._v(" "),s("li",[t._v("第一个文件是复制该应用下的同名文件，第二个pagetag.py 是自己写的")]),t._v(" "),s("li",[t._v("作用：能在html页面中，使用函数")])]),t._v(" "),s("p",[s("img",{attrs:{src:"BookShop%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0.assets/image-20200530172710314.png",alt:"image-20200530172710314"}})]),t._v(" "),s("h2",{attrs:{id:"在模板中自定义标签"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在模板中自定义标签"}},[t._v("#")]),t._v(" 在模板中自定义标签")]),t._v(" "),s("ul",[s("li",[t._v("也就是pagetag.py 内的代码，")]),t._v(" "),s("li",[t._v("实现了分页优化。")])]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" django "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" template\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" django"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("utils"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" format_html\nregister "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" template"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Library"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 自定义过滤器")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@register"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filter")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("xjq_upper")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("val"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" val"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("upper"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@register"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("simple_tag")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("jia")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 自定义分页页码的显示的标签")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@register"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("simple_tag")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("show_page")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("total_page"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 要求，显示的页码数不能超过十个")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 定义开头显示的页码和结尾显示的页码")]),t._v("\n    page_now "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("GET"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'page'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    page_now "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("page_now"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    start "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" page_now"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n    end "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" page_now"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 判断，当前页面处于左右两边的临界区域")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" page_now "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        start "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n        end "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" page_now "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" total_page"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        start "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" total_page"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v("\n        end "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" total_page\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" total_page "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        start "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n        end "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" total_page\n\n    page_html "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),t._v("\n    page_html "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("f'<li><a href=\"?page=")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\">首页</a></li>'")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" page_now"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        page_html "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f\'<li class="am-disabled"><a href="?page=')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("page_now "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\">上一页</a></li>'")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        page_html "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("f'<li><a href=\"?page=")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("page_now"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\">上一页</a></li>'")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("range")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("start"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" end"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果是当前页，需要高亮")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" page_now"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            page_html "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f\'<li class="am-active" ><a href="?page=')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('">')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("</a></li>'")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            page_html "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("f'<li><a href=\"?page=")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('">')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("</a></li>'")])]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" page_now "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" total_page"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        page_html "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f\'<li class="am-disabled"><a href="?page=')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("page_now "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\">下一页</a></li>'")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        page_html "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("f'<li><a href=\"?page=")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("page_now "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\">下一页</a></li>'")])]),t._v("\n    page_html "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("f'<li><a href=\"?page=")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("total_page"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\">尾页</a></li>'")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" format_html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("page_html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("ul",[s("li",[t._v("在html页面中使用我们自己写的函数")]),t._v(" "),s("li",[t._v("{% load 文件名 %}")]),t._v(" "),s("li",[t._v("{% 函数名 函数参数 %}")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('            {% load pagetag %}\n\x3c!-- <li class="am-disabled"><a href="#">«</a></li> --\x3e\n            {% show_page data.paginator.num_pages request %}\n\x3c!-- <li class="am-active"><a href="#">1</a></li> --\x3e\n')])])]),s("h1",{attrs:{id:"_2020-5-31-6-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2020-5-31-6-2"}},[t._v("#")]),t._v(" 2020.5.31-6.2")]),t._v(" "),s("h2",{attrs:{id:"图书分类模块的设计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#图书分类模块的设计"}},[t._v("#")]),t._v(" 图书分类模块的设计")]),t._v(" "),s("ul",[s("li",[t._v("图书拥有的操作")]),t._v(" "),s("li",[t._v("添加，列表显示，删除，编辑")]),t._v(" "),s("li",[t._v("图书分类模型：")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("列名")]),t._v(" "),s("th",[t._v("字段")]),t._v(" "),s("th",[t._v("类型")]),t._v(" "),s("th",[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("ID")]),t._v(" "),s("td",[t._v("id")]),t._v(" "),s("td",[t._v("主键")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("分类名称")]),t._v(" "),s("td",[t._v("Book_name")]),t._v(" "),s("td",[t._v("字符串")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("父级ID")]),t._v(" "),s("td",[t._v("Book_pid")]),t._v(" "),s("td",[t._v("数字")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("路径")]),t._v(" "),s("td",[t._v("Book_path")]),t._v(" "),s("td",[t._v("字符串")]),t._v(" "),s("td")])])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("分类\nID\t分类名\t\t父级ID\t路径path\t\n1\t人文社科\t0\t\t0，\n2\t小说\t\t 0\t\t\t0，\n3\t经济管理\t0\t\t0，\n4\t古籍\t\t 1\t\t\t0,1，\n5\t古经\t\t 4\t\t\t0,1,4\n6\t当代小说\t2\t\t0,2 \n")])])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("# 图书分类模型\nclass BookType(models.Model):\n    Book_name = models.CharField(max_length=10)\n    Book_pid = models.IntegerField()\n    Book_path = models.CharField(max_length=50)\n")])])]),s("h2",{attrs:{id:"数据库的迁移-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据库的迁移-2"}},[t._v("#")]),t._v(" 数据库的迁移")]),t._v(" "),s("ul",[s("li",[t._v("1.在bookshop项目文件路径内\n"),s("ul",[s("li",[t._v("执行迁移准备")]),t._v(" "),s("li",[t._v("python manage.py makemigrations")])])]),t._v(" "),s("li",[t._v("2、再执行迁移操作\n"),s("ul",[s("li",[t._v("python manage.py migrate")]),t._v(" "),s("li",[t._v("要在当前项目bookshop下执行")])])])]),t._v(" "),s("h2",{attrs:{id:"对myadmin后台视图进行优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#对myadmin后台视图进行优化"}},[t._v("#")]),t._v(" 对myadmin后台视图进行优化")]),t._v(" "),s("ul",[s("li",[t._v("1.在myadmin应用文件下创建views文件夹")]),t._v(" "),s("li",[t._v("2.把views文件夹变成一个包，需要有____init____.py这个文件\n"),s("ul",[s("li",[t._v("需要把views下的所有.py文件的名字都写入初始化文件中")])])]),t._v(" "),s("li",[t._v("3.对于处理不同模型的视图函数，建立不同的专属文件来处理")])]),t._v(" "),s("h3",{attrs:{id:"修改后的文件目录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改后的文件目录"}},[t._v("#")]),t._v(" 修改后的文件目录")]),t._v(" "),s("img",{attrs:{src:"BookShop项目笔记.assets/image-20200531094252900.png",alt:"image-20200531094252900"}}),t._v(" "),s("ul",[s("li",[t._v("init文件的内容")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("\n__all__ = [\n    'IndexViews',\n    'BooktypeViews',\n    'UsersViwes',\n]\n")])])]),s("ul",[s("li",[t._v("更改后的myadmin文件夹下的urls.py文件内容需要进行改变")]),t._v(" "),s("li",[s("img",{staticStyle:{zoom:"67%"},attrs:{src:"BookShop项目笔记.assets/image-20200531094435559.png",alt:"image-20200531094435559"}})])]),t._v(" "),s("h2",{attrs:{id:"对图书分类进行初始化操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#对图书分类进行初始化操作"}},[t._v("#")]),t._v(" 对图书分类进行初始化操作")]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"BookShop项目笔记.assets/image-20200531095849984.png",alt:"image-20200531095849984"}}),t._v(" "),s("ul",[s("li",[s("p",[t._v("书写基本的http响应")])]),t._v(" "),s("li",[s("p",[t._v("在urls中添加相应的路由")])])]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"BookShop项目笔记.assets/image-20200531095942682.png",alt:"image-20200531095942682"}}),t._v(" "),s("ul",[s("li"),t._v(" "),s("li",[t._v("***在myadmin的index.html中修改a链接的跳转网址")])]),t._v(" "),s("p",[s("img",{attrs:{src:"BookShop%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0.assets/image-20200531100434295.png",alt:"image-20200531100434295"}})]),t._v(" "),s("h2",{attrs:{id:"图书分类添加的实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#图书分类添加的实现"}},[t._v("#")]),t._v(" 图书分类添加的实现")]),t._v(" "),s("ul",[s("li",[t._v("图书分类存在所属关系，父级，子集存在着关联")]),t._v(" "),s("li",[t._v("下面是完成对添加网络请求的操作")])]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("BookType_add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    types "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" models"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BookType"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("objects"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    context "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'types'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" types"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("method "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GET'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" render"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'myadmin/booktype/add.html'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" context"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 接收表单数据")]),t._v("\n        data "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("POST"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("dict")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pop"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"csrfmiddlewaretoken"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# {'Book_pid': '1', 'Book_name': '玄幻'}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 判断当前添加的分类是否为顶级分类")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Book_pid'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Book_path'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0,'")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# {'Book_pid': '2', 'Book_name': '修仙'}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# path 是父级的path数据加上当前的父级Book_pid")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取父级对象")]),t._v("\n            obj "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" types"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Book_pid'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Book_path'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" obj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Book_path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Book_pid'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("','")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# {'Book_pid': '1', 'Book_name': '斗破苍穹', 'Book_path': '0,1,'}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 进行数据的添加")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        obj "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" models"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BookType"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("**")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        obj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("save"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        url "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" reverse"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'myadmin_BookType_index'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# /admin/BookType/index")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" HttpResponse"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f\'<script>alert("图书分类添加成功");location.href="')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"<\/script>'")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("except")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" HttpResponse"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f\'<script>alert("图书分类添加失败");history.back();"<\/script>\'')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" HttpResponse"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"BookType_add"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("ul",[s("li",[s("p",[t._v("关键是如下逻辑")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取父级对象")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# path 是父级的path数据加上当前的父级Book_pid")]),t._v("\nobj "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" types"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Book_pid'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndata"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Book_path'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" obj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Book_path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Book_pid'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("','")]),t._v("\n")])])])])]),t._v(" "),s("h2",{attrs:{id:"对数据库内的层级关系进行排序显示"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#对数据库内的层级关系进行排序显示"}},[t._v("#")]),t._v(" 对数据库内的层级关系进行排序显示")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("对应视频235")])]),t._v(" "),s("li",[s("p",[t._v("原来的显示如下")])]),t._v(" "),s("li",[s("img",{staticStyle:{zoom:"67%"},attrs:{src:"BookShop项目笔记.assets/image-20200601082855695.png",alt:"image-20200601082855695"}})]),t._v(" "),s("li",[s("p",[t._v("正确的应该是玄幻下面是初级玄幻，以及斗破苍穹")])]),t._v(" "),s("li",[s("p",[t._v("出现上图现象原因是，python语句")])])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("    data = models.BookType.objects.all()\n    # 这条语句，相当于在mysql中执行\n    # select * from myadmin_booktype;\n")])])]),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"BookShop项目笔记.assets/image-20200601083521369.png",alt:"image-20200601083521369"}}),t._v(" "),s("ul",[s("li",[s("p",[t._v("对数据库进行操作")])]),t._v(" "),s("li",[s("img",{staticStyle:{zoom:"67%"},attrs:{src:"BookShop项目笔记.assets/image-20200601082946044.png",alt:"image-20200601082946044"}})]),t._v(" "),s("li",[s("p",[t._v("mysql执行语句")])])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v(" # concat函数可以拼接两个字段，合为一个字符串，新别名为paths, 然后以这个新的别名来进行从小到大的排序\n # mysql中排序是按照ascall码进行排序的，所以第一列是最小，第二列是1.依次增大\n select *, concat(Book_path,id) as paths from myadmin_booktype order by paths;\n")])])]),s("ul",[s("li",[t._v("现在思考的问题就是如何把mysql的这条语句用python进行执行")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v(" # select * from myadmin_booktype;\n    # data = models.BookType.objects.all()\n    # select *, contcat(Book_path,id) as paths from myadmin_booktype order by paths;\n    data = models.BookType.objects.extra(select{'paths':'concat(Book_path,id)'}).order_by('paths')\n    context = {'data': data}\n    return render(request, 'myadmin/booktype/index.html', context=context)\n")])])]),s("h3",{attrs:{id:"处理缩进问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#处理缩进问题"}},[t._v("#")]),t._v(" 处理缩进问题")]),t._v(" "),s("ul",[s("li",[t._v("让刚才已经分好类的内容进行不同程度的缩进")]),t._v(" "),s("li",[t._v("这样增加可读性")]),t._v(" "),s("li",[t._v("逻辑\n"),s("ul",[s("li",[t._v("根据不同类型的路线Book_path 中包含的逗号作为缩进的依据")]),t._v(" "),s("li",[t._v("每一个类型的缩进个数为逗号个数-1")])])])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("  for i in data:\n        # print(type(i), i)\n        # <class 'myadmin.models.BookType'> BookType object (1)\n        num = i.Book_path.count(',')-1\n        i.nbsp = '|----' * num\n")])])]),s("h2",{attrs:{id:"ajax删除分类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ajax删除分类"}},[t._v("#")]),t._v(" ajax删除分类")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("视频236")])]),t._v(" "),s("li",[s("p",[t._v("删除逻辑")])]),t._v(" "),s("li",[s("p",[t._v("可以删除的类型满足的条件")]),t._v(" "),s("ul",[s("li",[t._v("该类型下没有子类")]),t._v(" "),s("li",[t._v("该类型下没有商品存在")])])])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("def BookType_delete(request):\n    # 获取要删除的分离的id\n    id = request.GET.get('id')\n    # 判断当前类下是否含有子类\n    num = models.BookType.objects.filter(Book_pid=id).count()\n    if num:\n        return JsonResponse({'error': 1, 'msg': '该类下含有子类，不能删除'})\n\n    # 判断该类下是否含有商品\n\n    # 执行删除\n    try:\n        obj = models.BookType.objects.get(id=id)\n        obj.delete()\n        return JsonResponse({'error': 0, 'msg': '删除成功'})\n    except:\n        return JsonResponse({'error': 3, 'msg': '删除失败'})\n\n")])])]),s("h2",{attrs:{id:"ajax编辑图书分离"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ajax编辑图书分离"}},[t._v("#")]),t._v(" ajax编辑图书分离")]),t._v(" "),s("h3",{attrs:{id:"script代码语法出错不会报"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#script代码语法出错不会报"}},[t._v("#")]),t._v(" script代码语法出错不会报")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("所有的javascript代码都会失效")])]),t._v(" "),s("li",[s("p",[t._v("django 中所有的post请求都需要通过CSRF验证")])]),t._v(" "),s("li",[s("p",[t._v("双击文字，让他变成一个input类型的标签，可以直接在页面对类型进行更改")])])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("// ajax编辑分类名称\n// type_name 所属span标签 $(this)是一个jQuery对象\n$('.type_name').dblclick(function(){\n           // 解决多次点击双击仍有效的bug\n           // 利用上锁开锁原理，保证同一时间内只能触发一次，标签可编辑\n           is = $(this).attr('isclick')\n           // 1.检测是否上锁\n           if(is == '0'){\n            // 没上锁, 对当前标签进行编辑操作\n                edit_type_name($(this))\n           }\n})\n\nfunction edit_type_name($this){\n// 此时的$this 变量已经是一个jQuery对象,对应着span标签\n\t// 进入函数后首先上锁\n\t$this.attr('isclick','1')\n // 1.绑定双击事件，获取当前的分类名称\n\tvar name = $this.text()\n\tvar id = $this.parents('tr').find('.book_id').text()\n   //alert(name)\n   // 2.创建一个input输入框，把name放进去\n   var inp = $('<input value=\"'+name+'\" style=\"color:black\">')\n   // 3.把input放置到显示的位置\n   $this.html(inp)\n   // 自动全选内容\n   inp.select()\n   // 4. 给input绑定丧失焦点事件\n   inp.blur(function(){\n   // 这里的$(this）对应着input标签\n\t\t// 5.丧失焦点后，获取更新后的name\n\t\tvar new_name = $(this).val()\n\t\t// alert(new_name)\n\t\t// 6.判断新的name是否发生了变化\n\t\tif(new_name == name){\n\t\t\t// 没变化，还原即可\n\t\t\t $this.html(name)\n\t\t}else{\n\t\t\t// 7.发送ajax请求去后台，更新分类的Book_name\n\t\t\t// $.post()参数：\n\t\t\t// 1.提交的地址,\n\t\t\t// 2.post请求提交的表单数据（以字典的形式传过去），\n\t\t\t// 3.回调函数function,参数：接收视图函数发来的数据\n\t\t\t// 4.回调接收的返回数据类型\n\n\t\t\t// django 中所有的post请求都需要通过CSRF验证\n\t\t\t$.ajaxSetup({\n\t\t\t\tdata:{csrfmiddlewaretoken: '{{ csrf_token }}'}\n\t\t\t})\n\t\t\t$.post('{% url 'myadmin_BookType_edit' %}',{'id':id, 'name': new_name}, function(data){\n\t\t\t\t//alert(data['msg'])\n\t\t\t\t// 8. 判断是否更新成功\n\t\t\t\tif(data['error']==0){\n\t\t\t\t   // 9.显示新的名字\n\t\t\t\t   $this.html(new_name)\n\t\t\t\t}else{\n\t\t\t\t\t$this.html(name)\n\t\t\t\t}\n\t\t\t}, 'json')\n\t\t}\n\t\t// 当丧失焦点后解锁\n\t\t$this.attr('isclick', '0')\n\t})\n}\n")])])]),s("ul",[s("li",[s("p",[t._v("这里面运用到了解锁，")]),t._v(" "),s("h3",{attrs:{id:"上锁问题解锁开锁问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#上锁问题解锁开锁问题"}},[t._v("#")]),t._v(" 上锁问题解锁开锁问题")]),t._v(" "),s("ul",[s("li",[t._v("初始状态设为开锁")])]),t._v(" "),s("p",[s("img",{attrs:{src:"BookShop%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0.assets/image-20200601172155296.png",alt:"image-20200601172155296"}})]),t._v(" "),s("ul",[s("li",[s("p",[t._v("每次双击进行判断，查看当前状态是否为上锁，不上锁，才能执行ajax不跳转编辑操作")]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"BookShop项目笔记.assets/image-20200601172339396.png",alt:"image-20200601172339396"}})]),t._v(" "),s("li",[s("p",[t._v("每次进入编辑操作时，先上锁，防止二次操作")]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"BookShop项目笔记.assets/image-20200601172432580.png",alt:"image-20200601172432580"}})]),t._v(" "),s("li",[s("p",[t._v("每次对一个标签操作完后，再进行解锁")])])])])]),t._v(" "),s("p",[s("img",{attrs:{src:"BookShop%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0.assets/image-20200601172600007.png",alt:"image-20200601172600007"}})]),t._v(" "),s("h1",{attrs:{id:"_2020-6-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2020-6-2"}},[t._v("#")]),t._v(" 2020.6.2 -")]),t._v(" "),s("h2",{attrs:{id:"图书商城模型设计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#图书商城模型设计"}},[t._v("#")]),t._v(" 图书商城模型设计")]),t._v(" "),s("h2",{attrs:{id:"图书商品拥有的功能"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#图书商品拥有的功能"}},[t._v("#")]),t._v(" 图书商品拥有的功能")]),t._v(" "),s("ul",[s("li",[t._v("添加，删除，修改，列表显示")])]),t._v(" "),s("h2",{attrs:{id:"图书模型设计："}},[s("a",{staticClass:"header-anchor",attrs:{href:"#图书模型设计："}},[t._v("#")]),t._v(" 图书模型设计：")]),t._v(" "),s("ul",[s("li",[t._v("一个分类标签对应多本书，一对多")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("列名")]),t._v(" "),s("th",[t._v("字段名")]),t._v(" "),s("th",[t._v("类型")]),t._v(" "),s("th",[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("id")]),t._v(" "),s("td",[t._v("id")]),t._v(" "),s("td",[t._v("主键")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("所属分类")]),t._v(" "),s("td",[t._v("Type_belong")]),t._v(" "),s("td",[t._v("一对多")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("书名")]),t._v(" "),s("td",[t._v("Title")]),t._v(" "),s("td",[t._v("models.CharField")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("推荐语")]),t._v(" "),s("td",[t._v("Tuijian")]),t._v(" "),s("td",[t._v("models.CharField")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("作者")]),t._v(" "),s("td",[t._v("Author")]),t._v(" "),s("td",[t._v("models.CharField")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("出版社")]),t._v(" "),s("td",[t._v("Publisher")]),t._v(" "),s("td",[t._v("models.CharField")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("出版时间")]),t._v(" "),s("td",[t._v("Pub_date")]),t._v(" "),s("td",[t._v("models.DateTimeField")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("定价")]),t._v(" "),s("td",[t._v("Price")]),t._v(" "),s("td",[t._v("models.IntegerField")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("库存数量")]),t._v(" "),s("td",[t._v("Num")]),t._v(" "),s("td",[t._v("models.IntegerField")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("国际书号ISBN")]),t._v(" "),s("td",[t._v("Isbn")]),t._v(" "),s("td",[t._v("models.CharField")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("详情介绍")]),t._v(" "),s("td",[t._v("Context")]),t._v(" "),s("td",[t._v("models.CharField")]),t._v(" "),s("td")])])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("\n# 图书商品模型\nclass Books(models.Model):\n    # 一对多，参数：当前类1对多的对象， 级联删除\n    # 主外关系键中，级联删除，也就是当删除主表的数据时候从表中的数据也随着一起删除\n    Type_belong = models.ForeignKey('BookType', on_delete=models.CASCADE)\n    Title = models.CharField(max_length=255)\n    Tuijian = models.CharField(max_length=255)\n    Author = models.CharField(max_length=50)\n    # 出版社\n    Publisher = models.CharField(max_length=100)\n    # 出版时间\n    Pub_date = models.DateTimeField()\n    Price = models.IntegerField()\n    # 库存\n    Num = models.IntegerField(default=10)\n    Isbn = models.CharField(max_length=13)\n    # 详情\n    Context = models.TextField()\n")])])]),s("h2",{attrs:{id:"图书封面图集模型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#图书封面图集模型"}},[t._v("#")]),t._v(" 图书封面图集模型")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("列名")]),t._v(" "),s("th",[t._v("字段")]),t._v(" "),s("th",[t._v("类型")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("所属图书")]),t._v(" "),s("td",[t._v("Book_belong")]),t._v(" "),s("td",[t._v("一对多")])]),t._v(" "),s("tr",[s("td",[t._v("封面图url")]),t._v(" "),s("td",[t._v("Book_img_url")]),t._v(" "),s("td",[t._v("models.CharField")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td"),t._v(" "),s("td")])])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("# 图书封面图集\nclass BookImgs(models.Model):\n    Book_belong = models.ForeignKey('Books', on_delete=models.CASCADE)\n    Book_img_url = models.CharField(max_length=100)\n\n")])])]),s("ul",[s("li",[s("p",[t._v("设计好模型后")])]),t._v(" "),s("li",[s("p",[t._v("生成迁移文件")]),t._v(" "),s("ul",[s("li",[t._v("在bookshop目录下执行 python manage.py makemigrations")])])]),t._v(" "),s("li",[s("p",[t._v("执行迁移文件")]),t._v(" "),s("ul",[s("li",[t._v("python manage.py migrate")])])])]),t._v(" "),s("p",[t._v("订单，")]),t._v(" "),s("p",[t._v("权限管理")]),t._v(" "),s("h2",{attrs:{id:"图书商品的添加"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#图书商品的添加"}},[t._v("#")]),t._v(" 图书商品的添加")]),t._v(" "),s("ul",[s("li",[t._v("注意\n"),s("ul",[s("li",[t._v("模型里有一对多的关系，所以那个属性应该对应着一个对象，而网页传来的是对象的id")])])])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("def Books_add(request):\n    if request.method == 'GET':\n        context = {'types': select_all_types()}\n        return render(request, 'myadmin/books/add.html', context=context)\n    else:\n        # 接收表单数据\n        data = request.POST.dict()\n        data.pop('csrfmiddlewaretoken')\n        # 检测是否上传了图书封面\n        if not request.FILES.get('Img_url', None):\n            return HttpResponse(f'<script>alert(\"至少上传一张图片\");history.back();<\/script>')\n        try:\n            # 添加图书对象\n            data['Type_belong'] = models.BookType.objects.get(id=data['Type_belong'])\n            book_obj = models.Books(**data)\n            book_obj.save()\n        except:\n            return HttpResponse(f'<script>alert(\"图书上传失败\");history.back();<\/script>')\n\n        try:\n            # 图书封面图的处理\n            img_obj = models.BookImgs()\n            # 一个图书有多个图书封面\n            img_obj.Book_belong = book_obj\n            img_obj.Book_img_url = Upload_file(request, 'Img_url')\n            img_obj.save()\n            print(data)\n        except:\n            book_obj.delete()\n            return HttpResponse(f'<script>alert(\"图书封面上传失败\");history.back();<\/script>')\n\n        url = reverse('myadmin_Books_index')\n        return HttpResponse(f'<script>alert(\"添加成功\");location.href=\"{url}\" <\/script>')\n")])])]),s("h2",{attrs:{id:"图书列表的显示"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#图书列表的显示"}},[t._v("#")]),t._v(" 图书列表的显示")]),t._v(" "),s("ul",[s("li",[t._v("注意！：图书图片的显示比较特殊")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("def Books_index(request):\n    # 接收数据\n    data = models.Books.objects.all()\n    # 访问关联对象参考\n    # https: // docs.djangoproject.com / zh - hans / 2.2 / ref / models / relations /\n    # print(data[0].bookimgs_set.first())\n    context = {'data': data}\n    return render(request, 'myadmin/books/index.html', context=context)\n")])])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('<td> <img src="{{ i.bookimgs_set.first.Book_img_url }}" class="tpl-table-line-img" alt="" /> </td>\n')])])]),s("ul",[s("li",[t._v("Html中函数不能加括号()")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('# print(data[0].bookimgs_set.first().Book_img_url)\nsrc="{{ i.bookimgs_set.first.Book_img_url }}"\n')])])]),s("h2",{attrs:{id:"添加富文本编辑器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#添加富文本编辑器"}},[t._v("#")]),t._v(" 添加富文本编辑器")]),t._v(" "),s("p",[t._v("把ueditor作为项目中的应用，加入到项目中去")]),t._v(" "),s("ul",[s("li",[t._v("作为一个APP ，和myadmin文件夹同级")]),t._v(" "),s("li",[t._v("在setting文件中配置app应用的加入")]),t._v(" "),s("li",[t._v("修改根路由文件，配置富文本编辑器的路由地址")]),t._v(" "),s("li",[s("img",{staticStyle:{zoom:"67%"},attrs:{src:"BookShop项目笔记.assets/image-20200605084539245.png",alt:"image-20200605084539245"}}),s("img",{attrs:{src:"BookShop%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0.assets/image-20200605084553255.png",alt:"image-20200605084553255"}})])]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"BookShop项目笔记.assets/image-20200605084624259.png",alt:"image-20200605084624259"}}),t._v(" "),s("ul",[s("li",[s("p",[t._v("在templates下的myadmin下创建demo.html")])]),t._v(" "),s("li",[s("p",[t._v("参考网址 http://fex.baidu.com/ueditor/#start-submit")]),t._v(" "),s("p",[t._v("css 会对富文本编辑器有影响")]),t._v(" "),s("p",[t._v("采用二分法，删除css样式对")])])]),t._v(" "),s("h2",{attrs:{id:"多图开发插插件应用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#多图开发插插件应用"}},[t._v("#")]),t._v(" 多图开发插插件应用")]),t._v(" "),s("p",[t._v("​\t从jq22.com白嫖插件，全是html插件")]),t._v(" "),s("ul",[s("li",[t._v("视频243")])])])}),[],!1,null,null,null);a.default=e.exports}}]);